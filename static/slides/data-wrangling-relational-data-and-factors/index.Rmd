---
title: "Data wrangling: relational data and factors"
author: "MACS 30500 <br /> University of Chicago"
output: rcfss::xaringan_wide
---

```{r setup, include=FALSE}
# generate CSS file
library(xaringanthemer)
rcfss::xaringan_theme()

options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  cache = TRUE,
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.width = 8, fig.asp = 0.618, fig.retina = 2, dpi = 150,
  fig.showtext = TRUE,
  fig.align = "center",
  out.width = "80%"
)

library(tidyverse)
library(here)
library(knitr)
library(countdown)
library(tidyexplain)
library(rcfss)

theme_set(theme_minimal(base_size = rcfss::base_size))
```

```{r anim-opts, include = FALSE}
set_anim_options(anim_opts = anim_options(text_size = 4, cell_width = 2, title_size = 14))
```

# Introduction to relational data

* Multiple tables of data that when combined together answer research questions
* Relations define the important element, not just the individual tables
* Relations are defined between a pair of tables
* Relational verbs
    * Mutating joins
    * Filtering joins

---

```{r}
include_graphics(path = "https://www.hindustantimes.com/rf/image_size_960x540/HT/p2/2018/02/08/Pictures/_33b2ca74-0cc1-11e8-ba67-a8387f729390.jpeg")
```

---

```{r kable}
superheroes_kable <- knitr::kable(superheroes, format = "html", caption = "Superheroes")
publishers_kable <- knitr::kable(publishers, format = "html", caption = "Publishers")
```

.pull-left[
  `r superheroes_kable`
]

.pull-right[
  `r publishers_kable`
]

---

class: inverse, center, middle

# Mutating joins

---

# `inner_join()`

```{r ijsp-anim, dependson = "anim-opts"}
animate_inner_join(x = superheroes, y = publishers, by = "publisher")
```

---

# `inner_join()`

```{r ijsp, echo = TRUE}
inner_join(x = superheroes, y = publishers, by = "publisher")
```

---

# `left_join()`

```{r ljsp-anim, dependson = "anim-opts"}
animate_left_join(x = superheroes, y = publishers, by = "publisher")
```

---

# `left_join()`

```{r ljsp, echo = TRUE}
left_join(x = superheroes, y = publishers, by = "publisher")
```

---

# `right_join()`

```{r rjsp-anim, dependson = "anim-opts"}
animate_right_join(x = superheroes, y = publishers, by = "publisher")
```

---

# `right_join()`

```{r rjsp, echo = TRUE}
right_join(x = superheroes, y = publishers, by = "publisher")
```

---

# `right_join()` reversed

```{r rjsp-alt-anim, dependson = "anim-opts"}
animate_left_join(x = publishers, y = superheroes, by = "publisher")
```

---

# `full_join()`

```{r fjsp-anim, dependson = "anim-opts"}
animate_full_join(x = superheroes, y = publishers, by = "publisher")
```

---

# `full_join()`

```{r fjsp, echo = TRUE}
full_join(x = superheroes, y = publishers, by = "publisher")
```

---

class: inverse, center, middle

# Filtering joins

---

# `semi_join()`

```{r sjsp-anim, dependson = "anim-opts"}
animate_semi_join(x = superheroes, y = publishers, by = "publisher")
```

---

# `semi_join()`

```{r sjsp, echo = TRUE}
semi_join(x = superheroes, y = publishers, by = "publisher")
```

---

# `anti_join()`

```{r ajsp-anim, dependson = "anim-opts"}
animate_anti_join(x = superheroes, y = publishers, by = "publisher")
```

---

# `anti_join()`

```{r ajsp, echo = TRUE}
anti_join(x = superheroes, y = publishers, by = "publisher")
```

---

# It's nannerpuss!

<div style='position:relative; padding-bottom:calc(76.67% + 44px)'><iframe src='https://gfycat.com/ifr/BogusAltruisticClumber' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen></iframe></div>

```{r cache = FALSE, echo = FALSE}
countdown(minutes = 10)
```

---

# Factors

* Used for categorical (discrete) variables
* Historically used for purposes of efficiency
* Not really necessary in modern R
* Best used to sort categorical variables other than alphabetically
* `forcats`

---

# Factors

## Character vector

```{r char, echo = TRUE, include = TRUE}
(x1 <- c("Dec", "Apr", "Jan", "Mar"))
sort(x1)
```

---

# Factors

## Levels

```{r levels, dependson = "char", echo = TRUE, include = TRUE}
month_levels <- c(
  "Jan", "Feb", "Mar", "Apr", "May", "Jun", 
  "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
)
```

## Factor

```{r factor, dependson = "levels", echo = TRUE, include = TRUE}
(y1 <- factor(x1, levels = month_levels))
parse_factor(x1, levels = month_levels)
```

---

# Different levels/labels

```{r months-num, dependson = "levels", echo = TRUE, include = TRUE}
(x2 <- c(12, 4, 1, 3))
(y2 <- factor(x2, 
              levels = seq(from = 1, to = 12),
              labels = month_levels))
```

---

# Let's practice!

<div style="width:100%;height:0;padding-bottom:72%;position:relative;"><iframe src="https://giphy.com/embed/fr9EtB6XzhCh2" width="100%" height="100%" style="position:absolute" frameBorder="0" class="giphy-embed" allowFullScreen></iframe></div>

```{r cache = FALSE, echo = FALSE}
countdown(minutes = 10)
```
