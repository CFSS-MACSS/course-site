<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Control Structures</title>
    <meta charset="utf-8" />
    <meta name="author" content="MACSS 30500   University of Chicago" />
    <script src="index_files/header-attrs/header-attrs.js"></script>
    <link href="index_files/panelset/panelset.css" rel="stylesheet" />
    <script src="index_files/panelset/panelset.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Control Structures
]
.author[
### MACSS 30500 <br /> University of Chicago
]

---






class: inverse, middle

# Overview of control structures in R 

&lt;!-- dropped from here vectors and lists, moved them to the data structure lecture 
added here conditional statements and more on iteration --&gt;

---

## Control Structures in R

* All programs we have written so far can be seen as a finite and fixed sequence of commands.
* Control structures allow us to vary our commands by controlling their flow of execution. 
* How? by adding some “logic” into our R code, rather than executing the same R code every time.

---

## Control Structures in R

The main control structures are:

* **`if... else` statements**: test a condition(s) and act on it
* **`for` loop**: execute a loop a fixed number of times
* **`while` loop**: execute a loop while a condition is true

See Chapter 13 “Control Structures” in *R programming for Data Science* and Chapter 21 “Iteration” in *R for Data Science* for more in-depth info.

---

class: inverse, middle

# Conditional Statements: if... else

---

### If-else 

The if-else combination allows you to test a condition and act on it, depending on whether the condition is evaluated TRUE or FALSE.

Syntax:
```
if (condition) {
    action performed if condition is TRUE
} 
else {
    action performed if condition is FALSE
}
```

Example:

```r
age &lt;- 14
if (age &gt; 16) {
  print("You are elegible to get a driving license")
} else {
  print("You cannot drive")
}
```

```
## [1] "You cannot drive"
```

---

### If-else 

Example: What is the output of this code?

```r
y &lt;- 10
if (y &lt; 20) {
  x &lt;- "Too low" 
} else {
  x &lt;- "Too high"
}
x
```

---

### If-else 

Example: What is the output of this code?

```r
my_numbers &lt;- c(3,4,5,"6",7)

if(!is.numeric(my_numbers)) {
  print("At least one argument is not numeric. Only provide numbers.")
} else {
  print("All numeric elements")
}
```

---

### If, else if, else

We can expand the basic if-else structure to incorporate multiple tests using `else if`


Syntax:
```
if (condition 1) {
    action 1 performed when condition 1 is TRUE
} 
else if (condition 2) {
    action 2 performed when condition 2 is TRUE
}
else {
    action performed when condition 2 is FALSE
}
```

---

### If, else if, else

We can expand the basic if-else structure to incorporate multiple tests using `else if`

Example:

```r
x &lt;- 0

# check if x is positive or negative or zero
if (x &gt; 0) {
  print("x is a positive number")
} else if (x &lt; 0) {
  print("x is a negative number")
} else {
  print("x is zero")
}
```

```
## [1] "x is zero"
```

---

### Nested if-else

We can also write nested if-else statement to specify conditions inside conditions:


```r
x &lt;- 15

# check if x is positive
if (x &gt; 0) {
  # execute if x is positive: check if x is even or odd
  if (x %% 2 == 0) {
    print("x is a positive even number")
  } else {
    print("x is a positive odd number")
  }

# execute if x is not positive
} else {
  # check if x is even or odd
  if (x %% 2 == 0) {
    print("x is a negative even number")
  } else {
    print("x is a negative odd number")
  }
}
```

```
## [1] "x is a positive odd number"
```

---

### ifelse()

R accepts `if()` and `else()` statements, but also statements using the built-in `ifelse()` function. Notice, there is a `dplyr` version of `ifelse()`, called `if_else()`: [documentation](https://dplyr.tidyverse.org/reference/if_else.html)


Syntax:
```
ifelse (condition to be evaluated,
        when condition is TRUE, this action will be performed,
        when condition is FALSE, this other action will be performed)
```

Example:

```r
y &lt;- 3
ifelse(sqrt(16) &gt; y, 
       sqrt(16),
       0)
```

```
## [1] 4
```

---

### ifelse()

Example: What is the output of this code?

```r
numbers &lt;- c(10, 6, 7)
ifelse(numbers %% 2 == 1, 
       "odd", 
       "even")
```

---

### ifelse()

Example: What is the output of this code?

```r
qualify &lt;- data.frame("Athlet" = c("Noah", "Julio", "Nick", "Maria"), 
                      "Scores" = c(32, 37, 28, 30))

ifelse(qualify$"Scores" &gt; 30, "Admitted", "Rejected")
```

&lt;!--
More on this:
https://docs.ycrc.yale.edu/r-novice-gapminder/07-control-flow/
Comparing ifelse() and for loop:
https://www.r-bloggers.com/2020/02/if-else-and-ifelse/
--&gt;

---

class: inverse, middle

# Practice writing if-else statements

---

class: inverse, middle

# Iteration: For loops

---

### For loops

For loops are the most common looping construct. Used to iterate over the elements of an object (list, vector, etc.) and apply some statement(s) to each of them (e.g., we do something with that element)

Syntax:
```
for (item in sequence of items) {
    statement(s)    
}
```

Example:

```r
for (i in 1:3){
  print(i)
}
```

```
## [1] 1
## [1] 2
## [1] 3
```

---

### For loops 

Example:

```r
for (i in 1:3){
  print(i)
}
```

```
## [1] 1
## [1] 2
## [1] 3
```

* Here the statement we are executing is simple: we just print `i` using the `print()` function. But at each iteration of the loop, the element `i` varies. 
* The number of repetitions of the statement block depends on the number of items in the sequence, in this example 3
* `i` can be called anything else

---

### For loops

Another example:

```r
for (i in 1:3){
  print(i)
  print("Hello")
  sum &lt;- i + 100
  print(sum)
}
```

```
## [1] 1
## [1] "Hello"
## [1] 101
## [1] 2
## [1] "Hello"
## [1] 102
## [1] 3
## [1] "Hello"
## [1] 103
```

&lt;!-- What is this loop doing? Have someone describing it 
what happens if I add a print(i) at the end outside the loop: prints last i--&gt;


---

### Nested for loops

- The outer loop takes control of the number of complete repetitions of the inner loop.
- The inner loop is executed N-times for every execution of the outer loop.


```r
for (i in 1:3) {
  print(i)
  for (j in c('a', 'b')) {
    print(j)
  }
}
```

```
## [1] 1
## [1] "a"
## [1] "b"
## [1] 2
## [1] "a"
## [1] "b"
## [1] 3
## [1] "a"
## [1] "b"
```

&lt;!--
for (i in 1:3) {
  print(i)
  for (j in c('a', 'b')) {
    print(i)
    print(paste(i, "outer"))
    print(j)
    print(paste(i,j))
  }
}
--&gt;

---

### Same operation without and with a for loop on a data frame

Get the data and remove missing rows:

```r
library(palmerpenguins)
data(penguins)
p &lt;- drop_na(penguins)

glimpse(penguins)
```

```
## Rows: 344
## Columns: 8
## $ species           &lt;fct&gt; Adelie, Adelie, Adelie, Adelie, Adelie, Adelie, Adel~
## $ island            &lt;fct&gt; Torgersen, Torgersen, Torgersen, Torgersen, Torgerse~
## $ bill_length_mm    &lt;dbl&gt; 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, ~
## $ bill_depth_mm     &lt;dbl&gt; 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, ~
## $ flipper_length_mm &lt;int&gt; 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186~
## $ body_mass_g       &lt;int&gt; 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, ~
## $ sex               &lt;fct&gt; male, female, female, NA, female, male, female, male~
## $ year              &lt;int&gt; 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007~
```

---

### Same operation without and with a for loop on a data frame

Calculate the mean value per each column **without a loop**:

```r
mean(p$bill_length_mm)
## [1] 43.99279
mean(p$bill_depth_mm)
## [1] 17.16486
mean(p$flipper_length_mm)
## [1] 200.967
mean(p$body_mass_g)
## [1] 4207.057
```

How can we do the same **with a for loop**? In-class demo 

---

### Same operation without and with a for loop on a data frame

Calculate the median value per each column **with a for loop**:

```r
# initialize empty vector to store results
output &lt;- vector(mode = "double", length = ncol(p))

# loop 
for (i in seq_along(p)) {
  output[[i]] &lt;- mean(p[[i]])
}
output
```

```
## [1]         NA         NA   43.99279   17.16486  200.96697 4207.05706         NA
## [8] 2008.04204
```
---

class: inverse, middle

# Practice writing for loops

---

class: inverse, middle

# Iteration: While loops

---

### While loops

* While loops begin by evaluating a condition. 
* If the condition is TRUE, then they execute the loop body. 
* Once the loop body is executed, R starts over: the condition is tested again, and so forth, until the condition is FALSE, after which the loop exits. 

Best used when you do not know how long the input sequence should run for. For example, you might want to loop until you get three heads in a row. You can’t do that with a for loop.

Syntax:
```
while (condition) {
statement(s)
}
```
---

### While loops

Syntax:
```
while (condition) {
statement(s)
}
```

Example:

```r
counter &lt;- 1

while(counter &lt;= 5) {
  print(counter)
  counter &lt;- counter + 1
}
```

```
## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
```

---

### While loops

Example: What is the output of this code?
```
counter &lt;- 1
while(counter &lt; 4){
  print(counter)
}
```

---

### While loops

Example: What is the output of this code?

```r
counter &lt;- 1
while(counter &lt; 4){
  print(counter)
  multiply &lt;- counter * 100
  print(multiply)
  counter &lt;- counter + 1
  print(counter)
}
```

```
## [1] 1
## [1] 100
## [1] 2
## [1] 2
## [1] 200
## [1] 3
## [1] 3
## [1] 300
## [1] 4
```


---

class: inverse, middle

# Iteration: For loops alternatives in R 

### Iteration with `map_*()` functions

---

## Map functions

`for` loops are good, but `map()` functions may be better

Types of `map()` functions:
- `map()` makes a list
-`map_lgl()` makes a logical vector
- `map_int()` makes an integer vector
- `map_dbl()` makes a double vector
- `map_chr()` makes a character vector

---

## Map functions

car_prices data frame:

```r
library(modeldata)
data(car_prices)
head(car_prices)
```

```
## # A tibble: 6 x 18
##    Price Mileage Cylinder Doors Cruise Sound Leather Buick Cadil~1 Chevy Pontiac
##    &lt;dbl&gt;   &lt;int&gt;    &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;   &lt;int&gt;
## 1 22661.   20105        6     4      1     0       0     1       0     0       0
## 2 21725.   13457        6     2      1     1       0     0       0     1       0
## 3 29143.   31655        4     2      1     1       1     0       0     0       0
## 4 30732.   22479        4     2      1     0       0     0       0     0       0
## 5 33359.   17590        4     2      1     1       1     0       0     0       0
## 6 30315.   23635        4     2      1     0       0     0       0     0       0
## # ... with 7 more variables: Saab &lt;int&gt;, Saturn &lt;int&gt;, convertible &lt;int&gt;,
## #   coupe &lt;int&gt;, hatchback &lt;int&gt;, sedan &lt;int&gt;, wagon &lt;int&gt;, and abbreviated
## #   variable name 1: Cadillac
```

---

## Map functions

car_prices data frame:

```r
map_dbl(car_prices, median)
```

```
##       Price     Mileage    Cylinder       Doors      Cruise       Sound 
##    18024.99    20913.50        6.00        4.00        1.00        1.00 
##     Leather       Buick    Cadillac       Chevy     Pontiac        Saab 
##        1.00        0.00        0.00        0.00        0.00        0.00 
##      Saturn convertible       coupe   hatchback       sedan       wagon 
##        0.00        0.00        0.00        0.00        1.00        0.00
```

```r
map_dbl(car_prices, sd)
```

```
##        Price      Mileage     Cylinder        Doors       Cruise        Sound 
## 9884.8527992 8196.3197068    1.3875313    0.8501688    0.4318356    0.4671113 
##      Leather        Buick     Cadillac        Chevy      Pontiac         Saab 
##    0.4473549    0.2995218    0.2995218    0.4897922    0.3898062    0.3490528 
##       Saturn  convertible        coupe    hatchback        sedan        wagon 
##    0.2629519    0.2416489    0.3794567    0.2629519    0.4881767    0.2708445
```

---

class: inverse, middle

# Practice writing `map_*()` functions


---

class: inverse, middle

# Iteration: For loops alternatives in R 

### Iteration in data frames with `across()`

---

### Single column


```r
car_prices %&gt;%
  summarize(Price = mean(Price))
```

```
## # A tibble: 1 x 1
##    Price
##    &lt;dbl&gt;
## 1 21343.
```

---

### Multiple columns


```r
car_prices %&gt;%
  summarize(
    Price = mean(Price),
    Mileage = mean(Mileage),
    Cylinder = mean(Cylinder),
    Doors = mean(Doors),
    Cruise = mean(Cruise),
    Sound = mean(Sound),
    Leather = mean(Leather),
    Buick = mean(Buick),
    Cadillac = mean(Cadillac),
    Chevy = mean(Chevy),
    Pontiac = mean(Pontiac),
    Saab = mean(Saab),
    Saturn = mean(Saturn),
    convertible = mean(convertible),
    coupe = mean(coupe),
    hatchback = mean(hatchback),
    sedan = mean(sedan),
    wagon = mean(wagon)
  )
```

```
## # A tibble: 1 x 18
##    Price Mileage Cylin~1 Doors Cruise Sound Leather  Buick Cadil~2 Chevy Pontiac
##    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1 21343.  19832.    5.27  3.53  0.752 0.679   0.724 0.0995  0.0995 0.398   0.187
## # ... with 7 more variables: Saab &lt;dbl&gt;, Saturn &lt;dbl&gt;, convertible &lt;dbl&gt;,
## #   coupe &lt;dbl&gt;, hatchback &lt;dbl&gt;, sedan &lt;dbl&gt;, wagon &lt;dbl&gt;, and abbreviated
## #   variable names 1: Cylinder, 2: Cadillac
```

---

## `dplyr::across()`

`across()` has two primary arguments:

* `.cols`, selects the columns you want to operate on
* `.fns`, is a function or list of functions to apply to each column

---

## `summarize()`, `across()`, and `everything()`

.panelset[
.panel[.panel-name[Single function]

```r
car_prices %&gt;%
  summarize(across(.cols = everything(), .fns = mean))
```

```
## # A tibble: 1 x 18
##    Price Mileage Cylin~1 Doors Cruise Sound Leather  Buick Cadil~2 Chevy Pontiac
##    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1 21343.  19832.    5.27  3.53  0.752 0.679   0.724 0.0995  0.0995 0.398   0.187
## # ... with 7 more variables: Saab &lt;dbl&gt;, Saturn &lt;dbl&gt;, convertible &lt;dbl&gt;,
## #   coupe &lt;dbl&gt;, hatchback &lt;dbl&gt;, sedan &lt;dbl&gt;, wagon &lt;dbl&gt;, and abbreviated
## #   variable names 1: Cylinder, 2: Cadillac
```
]

.panel[.panel-name[Multiple functions]

```r
car_prices %&gt;%
  summarize(across(everything(), .fns = list(min, max)))
```

```
## # A tibble: 1 x 36
##   Price_1 Price_2 Mileage_1 Mileage_2 Cylinder_1 Cylin~1 Doors_1 Doors_2 Cruis~2
##     &lt;dbl&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;int&gt;      &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
## 1   8639.  70755.       266     50387          4       8       2       4       0
## # ... with 27 more variables: Cruise_2 &lt;int&gt;, Sound_1 &lt;int&gt;, Sound_2 &lt;int&gt;,
## #   Leather_1 &lt;int&gt;, Leather_2 &lt;int&gt;, Buick_1 &lt;int&gt;, Buick_2 &lt;int&gt;,
## #   Cadillac_1 &lt;int&gt;, Cadillac_2 &lt;int&gt;, Chevy_1 &lt;int&gt;, Chevy_2 &lt;int&gt;,
## #   Pontiac_1 &lt;int&gt;, Pontiac_2 &lt;int&gt;, Saab_1 &lt;int&gt;, Saab_2 &lt;int&gt;,
## #   Saturn_1 &lt;int&gt;, Saturn_2 &lt;int&gt;, convertible_1 &lt;int&gt;, convertible_2 &lt;int&gt;,
## #   coupe_1 &lt;int&gt;, coupe_2 &lt;int&gt;, hatchback_1 &lt;int&gt;, hatchback_2 &lt;int&gt;,
## #   sedan_1 &lt;int&gt;, sedan_2 &lt;int&gt;, wagon_1 &lt;int&gt;, wagon_2 &lt;int&gt;, and ...
```
]

.panel[.panel-name[Multiple named functions]

```r
car_prices %&gt;%
  summarize(across(everything(), .fns = list(min = min, max = max)))
```

```
## # A tibble: 1 x 36
##   Price_min Price_max Mileage_~1 Milea~2 Cylin~3 Cylin~4 Doors~5 Doors~6 Cruis~7
##       &lt;dbl&gt;     &lt;dbl&gt;      &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
## 1     8639.    70755.        266   50387       4       8       2       4       0
## # ... with 27 more variables: Cruise_max &lt;int&gt;, Sound_min &lt;int&gt;,
## #   Sound_max &lt;int&gt;, Leather_min &lt;int&gt;, Leather_max &lt;int&gt;, Buick_min &lt;int&gt;,
## #   Buick_max &lt;int&gt;, Cadillac_min &lt;int&gt;, Cadillac_max &lt;int&gt;, Chevy_min &lt;int&gt;,
## #   Chevy_max &lt;int&gt;, Pontiac_min &lt;int&gt;, Pontiac_max &lt;int&gt;, Saab_min &lt;int&gt;,
## #   Saab_max &lt;int&gt;, Saturn_min &lt;int&gt;, Saturn_max &lt;int&gt;, convertible_min &lt;int&gt;,
## #   convertible_max &lt;int&gt;, coupe_min &lt;int&gt;, coupe_max &lt;int&gt;,
## #   hatchback_min &lt;int&gt;, hatchback_max &lt;int&gt;, sedan_min &lt;int&gt;, ...
```
]

.panel[.panel-name[Grouped by]

```r
car_prices %&gt;%
  group_by(Cylinder) %&gt;%
  summarize(across(everything(), .fns = mean))
```

```
## # A tibble: 3 x 18
##   Cylinder  Price Mileage Doors Cruise Sound Leather Buick Cadil~1 Chevy Pontiac
##      &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1        4 17863.  20108.  3.44  0.599 0.698   0.746 0      0      0.457   0.127
## 2        6 20081.  19564.  3.74  0.868 0.706   0.606 0.258  0.0645 0.387   0.258
## 3        8 38968.  19575.  3.2   1     0.52    1     0      0.6    0.2     0.2  
## # ... with 7 more variables: Saab &lt;dbl&gt;, Saturn &lt;dbl&gt;, convertible &lt;dbl&gt;,
## #   coupe &lt;dbl&gt;, hatchback &lt;dbl&gt;, sedan &lt;dbl&gt;, wagon &lt;dbl&gt;, and abbreviated
## #   variable name 1: Cadillac
```
]
]

---

## `worldbank`


```r
data("worldbank", package = "rcis")
worldbank
```

```
## # A tibble: 78 x 14
##    iso3c date  iso2c country   perc_en~1 rnd_g~2 percg~3 real_~4 gdp_c~5 top10~6
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 ARG   2005  AR    Argentina      89.1   0.379    15.5   6198.   5110.    35  
##  2 ARG   2006  AR    Argentina      88.7   0.400    22.1   7388.   5919.    33.9
##  3 ARG   2007  AR    Argentina      89.2   0.402    22.8   8182.   7245.    33.8
##  4 ARG   2008  AR    Argentina      90.7   0.421    21.6   8576.   9021.    32.5
##  5 ARG   2009  AR    Argentina      89.6   0.519    18.9   7904.   8225.    31.4
##  6 ARG   2010  AR    Argentina      89.5   0.518    17.9   8803.  10386.    32  
##  7 ARG   2011  AR    Argentina      88.9   0.537    17.9   9528.  12849.    31  
##  8 ARG   2012  AR    Argentina      89.0   0.609    16.5   9301.  13083.    29.7
##  9 ARG   2013  AR    Argentina      89.0   0.612    15.3   9367.  13080.    29.4
## 10 ARG   2014  AR    Argentina      87.7   0.613    16.1   8903.  12335.    29.9
## # ... with 68 more rows, 4 more variables: employment_ratio &lt;dbl&gt;,
## #   life_exp &lt;dbl&gt;, pop_growth &lt;dbl&gt;, pop &lt;dbl&gt;, and abbreviated variable names
## #   1: perc_energy_fosfuel, 2: rnd_gdpshare, 3: percgni_adj_gross_savings,
## #   4: real_netinc_percap, 5: gdp_capita, 6: top10perc_incshare
```

---

## `summarize()`, `across()`, and `where()`

.panelset[
.panel[.panel-name[Single condition]

```r
worldbank %&gt;%
  group_by(country) %&gt;%
  summarize(across(.cols = where(is.numeric), .fns = mean, na.rm = TRUE))
```

```
## # A tibble: 6 x 11
##   country        perc_~1 rnd_g~2 percg~3 real_~4 gdp_c~5 top10~6 emplo~7 life_~8
##   &lt;chr&gt;            &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 Argentina         89.1  0.501     17.5   8560.  10648.    31.6    55.4    75.4
## 2 China             87.6  1.67      48.3   3661.   5397.    30.8    69.8    74.7
## 3 Indonesia         65.3  0.0841    30.5   2041.   2881.    31.2    62.5    69.5
## 4 Norway            58.9  1.60      37.2  70775.  85622.    21.9    67.3    81.3
## 5 United Kingdom    86.3  1.68      13.5  34542.  43416.    26.2    58.7    80.4
## 6 United States     84.2  2.69      17.6  42824.  51285.    30.1    60.2    78.4
## # ... with 2 more variables: pop_growth &lt;dbl&gt;, pop &lt;dbl&gt;, and abbreviated
## #   variable names 1: perc_energy_fosfuel, 2: rnd_gdpshare,
## #   3: percgni_adj_gross_savings, 4: real_netinc_percap, 5: gdp_capita,
## #   6: top10perc_incshare, 7: employment_ratio, 8: life_exp
```
]

.panel[.panel-name[Compound condition]

```r
worldbank %&gt;%
  group_by(country) %&gt;%
  summarize(across(
    .cols = where(is.numeric) &amp; starts_with("perc"),
    .fn = mean, na.rm = TRUE
  ))
```

```
## # A tibble: 6 x 3
##   country        perc_energy_fosfuel percgni_adj_gross_savings
##   &lt;chr&gt;                        &lt;dbl&gt;                     &lt;dbl&gt;
## 1 Argentina                     89.1                      17.5
## 2 China                         87.6                      48.3
## 3 Indonesia                     65.3                      30.5
## 4 Norway                        58.9                      37.2
## 5 United Kingdom                86.3                      13.5
## 6 United States                 84.2                      17.6
```
]

]

---

## `across()` and `mutate()`


```r
car_prices %&gt;%
  mutate(across(.cols = Price:Doors, .fns = log10))
```

```
## # A tibble: 804 x 18
##    Price Mileage Cylinder Doors Cruise Sound Leather Buick Cadil~1 Chevy Pontiac
##    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;   &lt;int&gt;
##  1  4.36    4.30    0.778 0.602      1     0       0     1       0     0       0
##  2  4.34    4.13    0.778 0.301      1     1       0     0       0     1       0
##  3  4.46    4.50    0.602 0.301      1     1       1     0       0     0       0
##  4  4.49    4.35    0.602 0.301      1     0       0     0       0     0       0
##  5  4.52    4.25    0.602 0.301      1     1       1     0       0     0       0
##  6  4.48    4.37    0.602 0.301      1     0       0     0       0     0       0
##  7  4.52    4.24    0.602 0.301      1     1       1     0       0     0       0
##  8  4.48    4.44    0.602 0.301      1     0       1     0       0     0       0
##  9  4.48    4.40    0.602 0.301      1     0       0     0       0     0       0
## 10  4.43    4.24    0.602 0.602      1     0       1     0       0     0       0
## # ... with 794 more rows, 7 more variables: Saab &lt;int&gt;, Saturn &lt;int&gt;,
## #   convertible &lt;int&gt;, coupe &lt;int&gt;, hatchback &lt;int&gt;, sedan &lt;int&gt;, wagon &lt;int&gt;,
## #   and abbreviated variable name 1: Cadillac
```

---

## ~~`across()`~~ and `filter()`

.panelset[
.panel[.panel-name[`if_any()`]

```r
worldbank %&gt;%
  filter(if_any(everything(), ~ !is.na(.x)))
```

```
## # A tibble: 78 x 14
##    iso3c date  iso2c country   perc_en~1 rnd_g~2 percg~3 real_~4 gdp_c~5 top10~6
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 ARG   2005  AR    Argentina      89.1   0.379    15.5   6198.   5110.    35  
##  2 ARG   2006  AR    Argentina      88.7   0.400    22.1   7388.   5919.    33.9
##  3 ARG   2007  AR    Argentina      89.2   0.402    22.8   8182.   7245.    33.8
##  4 ARG   2008  AR    Argentina      90.7   0.421    21.6   8576.   9021.    32.5
##  5 ARG   2009  AR    Argentina      89.6   0.519    18.9   7904.   8225.    31.4
##  6 ARG   2010  AR    Argentina      89.5   0.518    17.9   8803.  10386.    32  
##  7 ARG   2011  AR    Argentina      88.9   0.537    17.9   9528.  12849.    31  
##  8 ARG   2012  AR    Argentina      89.0   0.609    16.5   9301.  13083.    29.7
##  9 ARG   2013  AR    Argentina      89.0   0.612    15.3   9367.  13080.    29.4
## 10 ARG   2014  AR    Argentina      87.7   0.613    16.1   8903.  12335.    29.9
## # ... with 68 more rows, 4 more variables: employment_ratio &lt;dbl&gt;,
## #   life_exp &lt;dbl&gt;, pop_growth &lt;dbl&gt;, pop &lt;dbl&gt;, and abbreviated variable names
## #   1: perc_energy_fosfuel, 2: rnd_gdpshare, 3: percgni_adj_gross_savings,
## #   4: real_netinc_percap, 5: gdp_capita, 6: top10perc_incshare
```
]

.panel[.panel-name[`if_all()`]

```r
worldbank %&gt;%
  filter(if_all(everything(), ~ !is.na(.x)))
```

```
## # A tibble: 42 x 14
##    iso3c date  iso2c country   perc_en~1 rnd_g~2 percg~3 real_~4 gdp_c~5 top10~6
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 ARG   2005  AR    Argentina      89.1   0.379    15.5   6198.   5110.    35  
##  2 ARG   2006  AR    Argentina      88.7   0.400    22.1   7388.   5919.    33.9
##  3 ARG   2007  AR    Argentina      89.2   0.402    22.8   8182.   7245.    33.8
##  4 ARG   2008  AR    Argentina      90.7   0.421    21.6   8576.   9021.    32.5
##  5 ARG   2009  AR    Argentina      89.6   0.519    18.9   7904.   8225.    31.4
##  6 ARG   2010  AR    Argentina      89.5   0.518    17.9   8803.  10386.    32  
##  7 ARG   2011  AR    Argentina      88.9   0.537    17.9   9528.  12849.    31  
##  8 ARG   2012  AR    Argentina      89.0   0.609    16.5   9301.  13083.    29.7
##  9 ARG   2013  AR    Argentina      89.0   0.612    15.3   9367.  13080.    29.4
## 10 ARG   2014  AR    Argentina      87.7   0.613    16.1   8903.  12335.    29.9
## # ... with 32 more rows, 4 more variables: employment_ratio &lt;dbl&gt;,
## #   life_exp &lt;dbl&gt;, pop_growth &lt;dbl&gt;, pop &lt;dbl&gt;, and abbreviated variable names
## #   1: perc_energy_fosfuel, 2: rnd_gdpshare, 3: percgni_adj_gross_savings,
## #   4: real_netinc_percap, 5: gdp_capita, 6: top10perc_incshare
```
]
]

---

class: inverse, middle

# Practice using `across()` iteration

---

## Acknowledgments 

The content of these slides is derived in part from Benjamin Soltoff’s “Computing for the Social Sciences” course materials, licensed under the CC BY NC 4.0 Creative Commons License. Any errors or oversights are mine alone.
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "magula",
"highlightLines": true,
"highlightLanguage": "r",
"ratio": "16:9",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
