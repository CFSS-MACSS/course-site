---
title: "Functions in R"
author: "MACSS 30500 <br /> University of Chicago"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    nature:
      highlightStyle: magula
      highlightLines: true
      highlightLanguage: r
      ratio: 16:9
      countIncrementalSlides: false
---

```{r setup, include = FALSE}
# generate CSS file
library(xaringanthemer)
style_duo_accent(
  primary_color = "#011f4b",
  secondary_color = "#bbd6c7",
  inverse_header_color = "#222222",
  black_color = "#222222",
  header_font_google = xaringanthemer::google_font("Atkinson Hyperlegible"),
  text_font_google = xaringanthemer::google_font("Atkinson Hyperlegible"),
  code_font_google = xaringanthemer::google_font("Source Code Pro"),
  base_font_size = "24px",
  code_font_size = "20px",
  # title_slide_background_image = "https://github.com/uc-dataviz/course-notes/raw/main/images/hexsticker.svg",
  # title_slide_background_size = "contain",
  # title_slide_background_position = "top",
  header_h1_font_size = "2rem",
  header_h2_font_size = "1.75rem",
  header_h3_font_size = "1.5rem",
  extra_css = list(
    "h1" = list(
      "margin-block-start" = "0.4rem",
      "margin-block-end" = "0.4rem"
    ),
    "h2" = list(
      "margin-block-start" = "0.4rem",
      "margin-block-end" = "0.4rem"
    ),
    "h3" = list(
      "margin-block-start" = "0.4rem",
      "margin-block-end" = "0.4rem"
    ),
    ".tiny" = list("font-size" = "70%"),
    ".small" = list("font-size" = "90%"),
    ".midi" = list("font-size" = "150%"),
    ".tiny .remark-code" = list("font-size" = "70%"),
    ".small .remark-code" = list("font-size" = "90%"),
    ".midi .remark-code" = list("font-size" = "150%"),
    ".large" = list("font-size" = "200%"),
    ".xlarge" = list("font-size" = "600%"),
    ".huge" = list(
      "font-size" = "400%",
      "font-family" = "'Montserrat', sans-serif",
      "font-weight" = "bold"
    ),
    ".hand" = list(
      "font-family" = "'Gochi Hand', cursive",
      "font-size" = "125%"
    ),
    ".task" = list(
      "padding-right" = "10px",
      "padding-left" = "10px",
      "padding-top" = "3px",
      "padding-bottom" = "3px",
      "margin-bottom" = "6px",
      "margin-top" = "6px",
      "border-left" = "solid 5px #F1DE67",
      "background-color" = "#F3D03E"
    ),
    ".pull-left" = list(
      "width" = "49%",
      "float" = "left"
    ),
    ".pull-right" = list(
      "width" = "49%",
      "float" = "right"
    ),
    ".pull-left-wide" = list(
      "width" = "70%",
      "float" = "left"
    ),
    ".pull-right-narrow" = list(
      "width" = "27%",
      "float" = "right"
    ),
    ".pull-left-narrow" = list(
      "width" = "27%",
      "float" = "left"
    ),
    ".pull-right-wide" = list(
      "width" = "70%",
      "float" = "right"
    ),
    ".blue" = list(color = "#2A9BB7"),
    ".purple" = list(color = "#a493ba"),
    ".yellow" = list(color = "#f1de67"),
    ".gray" = list(color = "#222222")
  )
)

source(here::here("R", "slide-opts.R"))
```

```{r pkgs, include = FALSE, cache = FALSE}
library(tidyverse)
library(palmerpenguins)
library(here)
library(countdown)

set.seed(1234)
theme_set(theme_minimal(base_size = rcis::base_size))
```

class: inverse, middle

# Functions

---

### Using existing functions

Functions are all over R! We have been **using functions** from day 1 of this class. For example:
```{r}
a <- c(1:10)
a
mean(a)
sqrt(a)
```

---

### Using existing functions

To use a function, we need to know its arguments and pass them correctly. We can type `help` in the console to learn more about a function behavior and its arguments:
```{r}
help(mean)
help(sqrt)
```

--

Some functions come from base R, like those I listed here, other functions have been developed from packages (e.g., all the functions from the tidyverse that we have been using). 

---

### Writing your own function

Other than using already defined functions, we can **create our own function**! 

A function has the following components:

* name and argument(s)
* body
* return statement

Syntax:
```
name <- function(arg1, arg2, ...) {  # name of function and arguments (inputs) it takes
    value <- body_of_function        # the body is the code that manipulates arguments
    return(value)                    # what the function returns (results)
    }
```
<!-- we can assign the function to a named object like any other object -->

---

### Writing your own function

For example, if the built-in mean function would not exist, we could **write our own mean function** to calculate the mean of a vector of numbers.

```
name <- function(arg1, arg2, ...) {  # name of function and arguments (inputs) it takes
    value <- body_of_function        # the body is the code that manipulates arguments
    return(value)                    # what the function returns (results)
    }
```

``` {r}
# long version
my_mean <- function(vector) {
    tot_values <- length(vector)
    m <- (sum(vector/tot_values))
    return(m)
}
```

``` {r}
# short version
my_mean <- function(vector) {
  sum(vector/length(vector))
}
```


---

### Writing your own function

To make a function work, we need to 'call' it with some values:
```{r}
a <- c(1:10)
my_mean(vector = a)
b <- c(1, 3, 6, 9, 20, 30)
my_mean(b)
```
The only argument of this function is `vector`. When we call the function, this argument will take a concrete vector (e.g., `a`, `b`, etc.). We can, but we do not have to, specify the argument name.
---

### Same code without a function

Without the mean function, we have to type the code to calculate the mean every time we need it:
```{r}
# calculate the mean of vector a
a <- c(1:10)
n <- length(a)
m <- (sum(a/n))
m
```

```{r}
# calculate the mean of vector b
b <- c(1, 3, 6, 9, 20, 30)
n <- length(b)
m <- (sum(b/n))
m
```

This code is redundant, more prone to errors, and less organized.

<!--
```{r}
b <- c(1, 3, 6, 9, 20, 30)
m <- (sum(b/length(b)))
m
```
-->

---

### So... What is a function?

A function, in the programming sense, is **code that is organized and named so that it can be executed by simply executing the name** (referred to as ‘calling’ a function). 

Functions:
* take some values as input and return output values
* simplify and organize our code (`incapsulation`) -- think about writing a paper: one function imports the data, another cleans the data, another split text into words, etc.
* make it easier to reuse our code
* reduce repetitive code: if you have copied and pasted a block of code more than twice, convert it to a function
 

---

### Writing your own function: things to notice

Names:

* provide **unique names for your functions** (e.g., `my_mean` vs `mean`); if you accidentally choose a function name that matches the name of existing R function, your function will override the existing function and only your function will be active in your current session

*  unless you have a reason to do so **do not create a new function if one already exists** (e.g., you do not want to create a `my_mean` function since `mean` is already defined in base R)

* provide **informative names** to your function: the name should tell you what the function does 

---

### Writing your own function: things to notice

Variables defined inside the function are **not available outside it**:

```{r}
rm()
```

``` {r}
my_mean <- function(vector) {
    tot_values <- length(vector)
    mean_var <- (sum(vector/tot_values))
    return(mean_var)
}
```

```{r, error = TRUE}
tot_values
```

```{r, error = TRUE}
mean_var
```

---

### Writing your own function: things to notice

If you do not write a **`return` statement**, the last statement will be your output:
```{r}
my_mean <- function(vector) {
    tot_values <- length(vector)
    sum(vector/tot_values)
}

my_mean(c(1:10))
```

It is good practice to write a `return` statement. Do not use `print`. 
Everything after your `return` statment will be ignored

---

### stop()

Let’s define a function fahr_to_kelvin() that converts temperatures from Fahrenheit to Kelvin:
```{r}
fahr_to_kelvin <- function(temp) {
  kelvin <- ((temp - 32) * (5 / 9)) + 273.15
  return(kelvin)
}
```
This example is taken from: https://swcarpentry.github.io/r-novice-gapminder/10-functions/index.html

```{r}
# freezing point of water
fahr_to_kelvin(32)
```

---

### stop()

For the `fahr_to_kelvin` function to work as intended, the argument `temp` must be a numeric value; otherwise, the conversion between the two temperature scales will not work. 

To create an error, we can use the function `stop()`: we can use an if statement to check that the argument `temp` is a numeric value, and throw and error if that's not the case:

```{r}
fahr_to_kelvin <- function(temp) {
  if (!is.numeric(temp)) {
    stop("temp must be a numeric vector.")
  }
  kelvin <- ((temp - 32) * (5 / 9)) + 273.15
  return(kelvin)
}
```
---

class: inverse, middle

# Practice writing Functions

---
## Acknowledgments 

The content of these slides is derived in part from Benjamin Soltoff’s “Computing for the Social Sciences” course materials, licensed under the CC BY NC 4.0 Creative Commons License. Any errors or oversights are mine alone.